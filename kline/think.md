### 思考过程

1. 前置步骤如何建立项目，在另一个题目中提到了。这里不讲
2. 审题：何为回测，设么叫平
    1. 查阅资料得知，回测是使用历史数据跑策略，验证策略是否正确的方法
    2. 平： 查阅资料得知是和自己已有持仓操作相反的动作。之前是买，现在就是卖，反之亦然。这个概念需要再确定
3. 综上所述理解题目
    1. 本题的题意是：一天的24小时中，本题的9个小时。在00：00：00开始考察是否买入
    2. 买入之后一分钟需要卖掉
    3. 买入的标准是买入时刻，前一分钟涨幅为百分之一
    4. 卖出为一分钟后直接卖出
    5. 每两分钟为操作对，即0分买入，1分卖出。然后2分买入，3分卖出，如此循环
4. 开始建立项目处理数据
5. 第一个问题，本文的数据是多个文本文件。需要批量读入文件，之前用的是tokio的fs,本题直接使用标准库
6. 本文和的数据处理和时间相关，所以需要把时间和文件关联起来，刚好数据文件的名字代表了数据来源的时间
7. 批量读入文件之后开始考虑时间问题
    1. 本次采用的时间处理库还是chrono,具体做法是读入文件，切掉文件的字母前缀，剩下和时间有关的参数
    2. 拿到有关参数后，开始切片（这里可能使用正则表达式更好）
    3. 利用迭代器的特性，把名字输入到chrono中，这样文件就可以按照时间排序了
    4. chrono可排序，保证了可以输出按照时间顺序排列的文件名，这个在后续的操作中很重要
    5. 建立了一个比较奇怪的struct 包含一个排序后的时间，和一个时间文件夹名的map方便使用
8. 然后开始读入csv
    1. 引入csv
    2. 本题的csv似乎不是标准csv,对csv并不熟悉，所以得到csv的record之后，自己祛除了 \t ，和说明相对应
9. 准备工作做好之后开始写入交易逻辑
10. 买
    1. 买很简单，涨幅超过百分之一即可，查看k线概念，收减去开大于百分之一即可
11. 卖
    1. 前一分钟买入后，后一分钟无条件卖出
    2. 卖出定义：保证是一个交易所，一个交易对，就是market pre_coin post_coin完全一样
    3. 在前一分钟获取需要买入的交易对，然后在后一分钟的所有csv record中找到对应的同一个市场同一个交易对算卖出价，累加
12. 完成好0, 1分钟的操作后，开始对整个小时的进行操作 从小到大解决
    1. 很好分组，两个数据文件一组，0分钟标记需要买入的交易对，在1分钟的记录中找到对应的交易对，开始相减
    2. 每组的操作一样都得到两个交易文件得出来的交易收益，最后所有的交易收益相加即可
13. 处理Corner Case
    1. 本次数据从0到540有541个文件，不构完整的两个文件一组的操作，所以需要注意数据不可以越界
    2. 缺陷是少处理了最后一个文件

### 目标

1. 以上提到的点，每个都尽量提一个小的函数，函数的功能不要多，尽可能的分离函数的功能，提高可读性
2. 还是追求main函数的简介，争取在main中可以直接看出来程序的主逻辑，即上面的 3 只看main也可以看出来

### 问题

1. 还是错误处理不够
2. 策略是否如此，并不确定，但是尽量拆分开函数，也写了思考过程，方便改进。
3. 结果可能是错的，因为后来查看数据，发现不仅有usdt的交易对，还有usd busd btc 的交易，这个代码统一当做usdt为标准，所以最好要分开统计。
4. 如果需要改正，请去交易模块 trade 中查看sale函数，sale中处理了两个交易时间的问题，即完成了最小完整交易---->买和卖
5. 如果按照现在这个交易模式，完全可以改成多线程，并行处理